<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Diary of a reverse-engineer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Axel '0vercl0k' Souchet">
    <link rel="stylesheet" href="/theme/css/bootstrap.min.css" type="text/css" />
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .tag-1 {
        font-size: 13pt;
      }
      .tag-2 {
        font-size: 10pt;
      }
      .tag-2 {
        font-size: 8pt;
      }
      .tag-4 {
        font-size: 6pt;
     }
    </style>
    <link href="/theme/css/bootstrap-responsive.min.css" rel="stylesheet" />
    <link href="/theme/css/font-awesome.css" rel="stylesheet" />
    <link href="/theme/css/pygments.css" rel="stylesheet" />

    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Diary of a reverse-engineer ATOM Feed" />
    <link href="/feeds/rss.xml" type="application/atom+xml" rel="alternate" title="Diary of a reverse-engineer RSS Feed" />

  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/index.html">Diary of a reverse-engineer </a>
          <div class="nav-collapse">
            <ul class="nav">
              <ul class="nav">
                    <li><a href="/archives.html"><i class="icon-th-list"></i>Archives</a></li>
              </ul>

                <li >
                    <a href="/category/debugging.html">
                      <i class="icon-folder-open icon-large"></i>debugging
                    </a>
                </li>
                <li >
                    <a href="/category/exploitation.html">
                      <i class="icon-folder-open icon-large"></i>exploitation
                    </a>
                </li>
                <li >
                    <a href="/category/misc.html">
                      <i class="icon-folder-open icon-large"></i>misc
                    </a>
                </li>
                <li >
                    <a href="/category/obfuscation.html">
                      <i class="icon-folder-open icon-large"></i>obfuscation
                    </a>
                </li>
                <li >
                    <a href="/category/reverse-engineering.html">
                      <i class="icon-folder-open icon-large"></i>reverse-engineering
                    </a>
                </li>

                <li><a href="/pages/about.html">About</a></li>
                <li><a href="/pages/presentations.html">Presentations</a></li>

            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row">
        <div class="span9" id="content">
        <div class="article">
                <h1><a href="/blog/2018/11/19/introduction-to-spidermonkey-exploitation/">Introduction to SpiderMonkey exploitation.</a></h1>
                <div class="well small"><footer class="post-info">
<span class="label">Date</span>
<abbr class="published" title="2018-11-19T08:25:00-08:00">
        <i class="icon-calendar"></i>Mon 19 November 2018
</abbr>
<span class="label">By</span>
<a href="/author/axel-0vercl0k-souchet.html"><i class="icon-user"></i>Axel "0vercl0k" Souchet</a>
<span class="label">Category</span>
<a href="/category/exploitation.html"><i class="icon-folder-open"></i>exploitation</a>


<span class="label">Tags</span>
	<a href="/tag/spidermonkey.html"><i class="icon-tag"></i>spidermonkey</a>
	<a href="/tag/blazefox.html"><i class="icon-tag"></i>blazefox</a>
	<a href="/tag/exploitation.html"><i class="icon-tag"></i>exploitation</a>
	<a href="/tag/windows.html"><i class="icon-tag"></i>windows</a>
	<a href="/tag/ttd.html"><i class="icon-tag"></i>ttd</a>
</footer><!-- /.post-info --></div>
                <div class="summary"><h1 id="introduction">Introduction</h1>
<p>This blogpost covers the development of three exploits targeting SpiderMonkey JavaScript Shell interpreter and Mozilla Firefox on Windows 10 RS5 64-bit from the perspective of somebody that has never written a browser exploit nor looked closely at any JavaScript engine codebase.</p>
<p>As you have probably noticed, there has been a LOT of interest in exploiting browsers in the past year or two. Every major CTF competition has at least one browser challenge, every month there are at least a write-up or two touching on browser exploitation. It is just everywhere. That is kind of why I figured I should have a little look at what a JavaScript engine is like from inside the guts, and exploit one of them. I have picked Firefox's SpiderMonkey JavaScript engine and the challenge <a href="https://ctftime.org/task/6000">Blazefox</a> that has been written by <a href="https://twitter.com/itszn13">itszn13</a>.</p>
<p>In this blogpost, I present my findings and the <a href="https://github.com/0vercl0k/blazefox/blob/master/exploits">three exploits</a> I have written during this quest. Originally, the challenge was targeting a Linux x64 environment and so naturally I decided to exploit it on Windows x64 :). Now you may wonder why three different exploits? Three different exploits allowed me to take it step by step and not face all the complexity at once. That is usually how I work day to day, I make something small work and iterate to build it up.</p>
<p>Here is how I organized things:</p>
<ul>
<li>
<p>The first thing I wrote is a WinDbg JavaScript extension called <a href="https://github.com/0vercl0k/windbg-scripts/tree/master/sm">sm.js</a> that gives me visibility into a bunch of stuff in SpiderMonkey. It is also a good exercise to familiarize yourself with the various ways objects are organized in memory. It is not necessary, but it has been definitely useful when writing the exploits.</p>
</li>
<li>
<p>The first exploit, <code>basic.js</code>, targets a very specific build of the JavaScript interpreter, <code>js.exe</code>. It is full of hardcoded ugly offsets, and would have no chance to land elsewhere than on my system with this specific build of <code>js.exe</code>.</p>
</li>
<li>
<p>The second exploit, <code>kaizen.js</code>, is meant to be a net improvement of <code>basic.js</code>. It still targets the JavaScript interpreter itself, but this time, it resolves dynamically a bunch of things like a big boy. It also uses the baseline JIT to have it generate ROP gadgets.</p>
</li>
<li>
<p>The third exploit, <code>ifrit.js</code>, finally targets the Firefox browser with a little extra. Instead of just leveraging the baseline JIT to generate one or two ROP gadgets, we make it JIT a whole native code payload. No need to ROP, scan for finding Windows API addresses or to create a writable and executable memory region anymore. We just redirect the execution flow to our payload inside the JIT code. This might be the less dull / interesting part for people that knows SpiderMonkey and have been doing browser exploitation already :).</p>
</li>
</ul>
<p>Before starting, for those who do not feel like reading through the whole post: <strong>TL;DR</strong> I have created a <a href="https://github.com/0vercl0k/blazefox">blazefox</a> GitHub repository that you can clone with all the materials. In the repository you can find:</p>
<ul>
<li><a href="https://github.com/0vercl0k/blazefox/tree/master/sm">sm.js</a> which is the debugger extension mentioned above,</li>
<li>The source code of the three exploits in <a href="https://github.com/0vercl0k/blazefox/tree/master/exploits">exploits</a>,</li>
<li>A 64-bit debug build of the JavaScript shell along with private symbol information in <a href="https://github.com/0vercl0k/blazefox/tree/master/js-asserts">js-asserts</a>, and a release build in <a href="https://github.com/0vercl0k/blazefox/tree/master/js-release">js-release</a>,</li>
<li>The scripts I used to build the <strong>B</strong>ring <strong>Y</strong>our <strong>O</strong>wn <strong>P</strong>ayload technique in <a href="https://github.com/0vercl0k/blazefox/tree/master/scripts">scripts</a>,</li>
<li>The sources that have been used to build <code>js-release</code> so that you can do source-level debugging in WinDbg in <a href="https://github.com/0vercl0k/blazefox/tree/master/src/js">src/js</a>,</li>
<li>A 64-bit build of the Firefox binaries along with private symbol information for <code>xul.dll</code> in <a href="https://github.com/0vercl0k/blazefox/blob/master/ff-bin.7z.001">ff-bin.7z.001</a> and <a href="https://github.com/0vercl0k/blazefox/blob/master/ff-bin.7z.002">ff-bin.7z.002</a>.</li>
</ul>
<p>All right, let's buckle up and hit the road now!</p>

                        <a class="btn primary xsmall" href="/blog/2018/11/19/introduction-to-spidermonkey-exploitation/">more ...</a>
                </div>
        </div>
        <hr />
        <div class="article">
                <h1><a href="/blog/2018/07/14/cve-2017-2446-or-jscjsglobalobjectishavingabadtime/">CVE-2017-2446 or JSC::JSGlobalObject::isHavingABadTime.</a></h1>
                <div class="well small"><footer class="post-info">
<span class="label">Date</span>
<abbr class="published" title="2018-07-14T18:49:00-07:00">
        <i class="icon-calendar"></i>Sat 14 July 2018
</abbr>
<span class="label">By</span>
<a href="/author/yrp.html"><i class="icon-user"></i>yrp</a>
<span class="label">Category</span>
<a href="/category/exploitation.html"><i class="icon-folder-open"></i>exploitation</a>


<span class="label">Tags</span>
	<a href="/tag/javascriptcore.html"><i class="icon-tag"></i>JavascriptCore</a>
	<a href="/tag/jsc.html"><i class="icon-tag"></i>jsc</a>
	<a href="/tag/cve-2017-2446.html"><i class="icon-tag"></i>cve-2017-2446</a>
	<a href="/tag/exploitation.html"><i class="icon-tag"></i>exploitation</a>
</footer><!-- /.post-info --></div>
                <div class="summary"><h1 id="introduction">Introduction</h1>
<p>This post will cover the development of an exploit for JavaScriptCore (JSC) from the perspective of someone with no background in browser exploitation.</p>
<p>Around the start of the year, I was pretty burnt out on CTF problems and was interested in writing an exploit for something more complicated and practical. I settled on writing a WebKit exploit for a few reasons:</p>
<ul>
<li>It is code that is broadly used in the real world</li>
<li>Browsers seemed like a cool target in an area I had little familiarity (both C++ and interpreter exploitation.)</li>
<li>WebKit is (supposedly) the softest of the major browser targets.</li>
<li>There were good existing resources on WebKit exploitation, namely <a href="http://phrack.org/papers/attacking_javascript_engines.html">saelo’s Phrack article</a>, as well as a variety of public console exploits.</li>
</ul>
<p>With this in mind, I got a recommendation for an interesting looking bug that has not previously been publicly exploited: <a href="https://twitter.com/natashenka">@natashenka</a>’s CVE-2017-2446 from the <a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=1032">project zero bugtracker</a>. The bug report had a PoC which crashed in <code>memcpy()</code> with some partially controlled registers, which is always a promising start.</p>
<p>This post assumes you’ve read saelo’s Phrack article linked above, particularly the portions on NaN boxing and butterflies -- I can’t do a better job of explaining these concepts than the article. Additionally, you should be able to run a browser/JavaScript engine in a debugger -- we will target Linux for this post, but the concepts should translate to your preferred platform/debugger.</p>
<p>Finally, the goal of doing this initially and now writing it up was and is to learn as much as possible. There is clearly a lot more for me to learn in this area, so if you read something that is incorrect, inefficient, unstable, a bad idea, or just have some thoughts to share, I’d love to hear from you.</p>

                        <a class="btn primary xsmall" href="/blog/2018/07/14/cve-2017-2446-or-jscjsglobalobjectishavingabadtime/">more ...</a>
                </div>
        </div>
        <hr />
        <div class="article">
                <h1><a href="/blog/2018/05/17/breaking-ledgerctfs-aes-white-box-challenge/">Breaking ledgerctf's AES white-box challenge</a></h1>
                <div class="well small"><footer class="post-info">
<span class="label">Date</span>
<abbr class="published" title="2018-05-17T11:52:00-07:00">
        <i class="icon-calendar"></i>Thu 17 May 2018
</abbr>
<span class="label">By</span>
<a href="/author/axel-0vercl0k-souchet.html"><i class="icon-user"></i>Axel "0vercl0k" Souchet</a>
<span class="label">Category</span>
<a href="/category/reverse-engineering.html"><i class="icon-folder-open"></i>reverse-engineering</a>


<span class="label">Tags</span>
	<a href="/tag/reverse-engineering.html"><i class="icon-tag"></i>reverse-engineering</a>
	<a href="/tag/ledgerctf.html"><i class="icon-tag"></i>ledgerctf</a>
	<a href="/tag/whitebox.html"><i class="icon-tag"></i>whitebox</a>
</footer><!-- /.post-info --></div>
                <div class="summary"><h1 id="introduction">Introduction</h1>
<p>About a month ago, my mate <a href="https://twitter.com/b0n0n">b0n0n</a> was working on the <a href="https://www.ledger.fr/ctf2018/">ledgerctf</a> puzzles and challenged me to have a look at the <em>ctf2</em> binary. I eventually did and this blogpost discusses the protection scheme and how I broke it. Before diving in though, here is a bit of background.</p>
<p><a href="https://www.ledger.fr/">ledger</a> is a french security company founded in 2014 that is specialized in cryptography, cryptocurrencies, and hardware. They recently put up online three different puzzles to celebrate the official launch of their <a href="https://www.ledger.fr/bounty-program/">bug bounty program</a>. The second challenge called <em>ctf2</em> is the one we will be discussing today. <em>ctf2</em> is an ELF64 binary that is available <a href="https://drive.google.com/open?id=1UPLe3V5Jt3SMqZe4ZIFcnWydSqUyI4Ao">here</a> for download (if you want to follow at home). The binary is about 11MB, written in C++ and even has symbols; great.</p>
<p>Let's do it!</p>

                        <a class="btn primary xsmall" href="/blog/2018/05/17/breaking-ledgerctfs-aes-white-box-challenge/">more ...</a>
                </div>
        </div>
        <hr />
        <div class="article">
                <h1><a href="/blog/2018/03/11/bevx-challenge-on-the-operation-table/">beVX challenge on the operation table</a></h1>
                <div class="well small"><footer class="post-info">
<span class="label">Date</span>
<abbr class="published" title="2018-03-11T17:22:00-07:00">
        <i class="icon-calendar"></i>Sun 11 March 2018
</abbr>
<span class="label">By</span>
<a href="/author/axel-0vercl0k-souchet.html"><i class="icon-user"></i>Axel "0vercl0k" Souchet</a>
<span class="label">Category</span>
<a href="/category/reverse-engineering.html"><i class="icon-folder-open"></i>reverse-engineering</a>


<span class="label">Tags</span>
	<a href="/tag/reverse-engineering.html"><i class="icon-tag"></i>reverse-engineering</a>
	<a href="/tag/bevx.html"><i class="icon-tag"></i>beVX</a>
</footer><!-- /.post-info --></div>
                <div class="summary"><h1 id="introduction">Introduction</h1>
<p>About two weeks ago, my friend <a href="https://twitter.com/mongobug">mongo</a> challenged me to solve a reverse-engineering puzzle put up by the <a href="https://blogs.securiteam.com/">SSD</a> team for <a href="https://www.offensivecon.org/">OffensiveCon2018</a> (which is a security conference that took place in Berlin in February). The challenge binary is available for download <a href="https://www.beyondsecurity.com/bevxcon/bevx-challenge-1">here</a> and <a href="https://twitter.com/SecuriTeam_SSD/status/964459126960066560">here is one of the original tweet</a> advertising it.</p>
<p>With this challenge, you are tasked to reverse-engineer a binary providing some sort of encryption service, and there is supposedly a private key (aka the flag) to retrieve. A remote server with the challenge running is also available for you to carry out your attack. This looked pretty interesting as it was different than the usual keygen-me type of reverse-engineering challenge.</p>
<p>Unfortunately, I didn't get a chance to play with this while the remote server was up (the organizers took it down once they received the solutions of the three winners). However, cool thing is that you can easily manufacture your own server to play at home.. which is what I ended up doing.</p>
<p>As I thought the challenge was cute enough, and that I would also like to write on a more regular basis, so here is a small write-up describing how I abused the server to get the private key out. Hope you don't find it too boring :-).</p>

                        <a class="btn primary xsmall" href="/blog/2018/03/11/bevx-challenge-on-the-operation-table/">more ...</a>
                </div>
        </div>
        <hr />
        <div class="article">
                <h1><a href="/blog/2017/12/01/debugger-data-model/">Debugger data model, Javascript & x64 exception handling</a></h1>
                <div class="well small"><footer class="post-info">
<span class="label">Date</span>
<abbr class="published" title="2017-12-01T06:59:00-08:00">
        <i class="icon-calendar"></i>Fri 01 December 2017
</abbr>
<span class="label">By</span>
<a href="/author/axel-0vercl0k-souchet.html"><i class="icon-user"></i>Axel "0vercl0k" Souchet</a>
<span class="label">Category</span>
<a href="/category/debugging.html"><i class="icon-folder-open"></i>debugging</a>


<span class="label">Tags</span>
	<a href="/tag/debugging.html"><i class="icon-tag"></i>debugging</a>
	<a href="/tag/javascript.html"><i class="icon-tag"></i>javascript</a>
	<a href="/tag/windbg.html"><i class="icon-tag"></i>windbg</a>
	<a href="/tag/exception-handling.html"><i class="icon-tag"></i>exception handling</a>
	<a href="/tag/seh.html"><i class="icon-tag"></i>seh</a>
	<a href="/tag/time-travel-debugging.html"><i class="icon-tag"></i>time-travel debugging</a>
	<a href="/tag/ttd.html"><i class="icon-tag"></i>ttd</a>
</footer><!-- /.post-info --></div>
                <div class="summary"><h1 id="introduction">Introduction</h1>
<p>The main goal of today's post is to show a bit more of what is now possible with the latest Windbg (currently branded <a href="https://blogs.windows.com/buildingapps/2017/08/28/new-windbg-available-preview/">"WinDbg Preview"</a> in the Microsoft store) and the time travel debugging tools that Microsoft released a few months ago. When these finally got released, a bit after <a href="https://cppcon2017.sched.com/">cppcon2017</a> this year, I expected a massive pick-up from the security / reverse-engineering industry with a bunch of posts, tools, scripts, etc. To my surprise, this has not happened yet so I have waited patiently for my vacation to write a little something about it myself. So, here goes!</p>
<p>Obviously, one of the most <em>noticeable</em> change in this debugger is the new UI.. but this is not something we will talk about. The <em>second</em> big improvement is .. a decent scripting engine! Until recently, I always had to use <a href="https://pykd.codeplex.com/">pyKD</a> to write automation scripts. This has worked <em>fairly</em> well for years, but I’m glad to move away from it and embrace the new extension model provided by Windbg &amp; Javascript (yes, you read this right). One of the biggest pain point I’ve to deal with with pyKD (aside from the installation process!) is that you had to evaluate many commands and then parse their outputs to extract the bits and pieces you needed. Thankfully, the new <em>debugger data model</em> solves this (or part of this anyway). The third new change is the integration of the time travel debugging (TTD) features discussed in this presentation: <a href="https://cppcon2017.sched.com/event/Bgsj/time-travel-debugging-root-causing-bugs-in-commercial-scale-software">Time Travel Debugging: Root Causing Bugs in Commercial Scale Software
</a>.</p>
<p>The goal of this post is to leverage all the nifty stuff we will learn to enumerate x64 <a href="https://docs.microsoft.com/fr-fr/cpp/cpp/try-except-statement">try/except</a> handlers in Javascript.</p>
<p>So grab yourself a cup of fine coffee and read on :).</p>

                        <a class="btn primary xsmall" href="/blog/2017/12/01/debugger-data-model/">more ...</a>
                </div>
        </div>
        <hr />
        <div class="article">
                <h1><a href="/blog/2017/08/05/binary-rewriting-with-syzygy/">Binary rewriting with syzygy, Pt. I</a></h1>
                <div class="well small"><footer class="post-info">
<span class="label">Date</span>
<abbr class="published" title="2017-08-05T16:08:00-07:00">
        <i class="icon-calendar"></i>Sat 05 August 2017
</abbr>
<span class="label">By</span>
<a href="/author/axel-0vercl0k-souchet.html"><i class="icon-user"></i>Axel "0vercl0k" Souchet</a>
<span class="label">Category</span>
<a href="/category/misc.html"><i class="icon-folder-open"></i>misc</a>


<span class="label">Tags</span>
	<a href="/tag/binary-rewriting.html"><i class="icon-tag"></i>binary rewriting</a>
	<a href="/tag/syzygy.html"><i class="icon-tag"></i>syzygy</a>
	<a href="/tag/program-analysis.html"><i class="icon-tag"></i>program analysis</a>
</footer><!-- /.post-info --></div>
                <div class="summary"><h1 id="introduction">Introduction</h1>
<p>Binary instrumentation and analysis have been subjects that I have always found fascinating. At compile time via <a href="http://doar-e.github.io/blog/2016/11/27/clang-and-passes/">clang</a>, or at runtime with dynamic binary instrumentation frameworks like <a href="https://software.intel.com/en-us/articles/pin-a-dynamic-binary-instrumentation-tool">Pin</a> or <a href="http://www.dynamorio.org/">DynamoRIO</a>. One thing I have always looked for though, is a framework able to statically instrument a PE image. A framework designed a bit like <a href="https://clang.llvm.org/">clang</a> where you can write 'passes' doing various things: transformation of the image, analysis of code blocks, etc. Until a couple of months ago, I wasn't aware of any public and robust projects providing this capability (as in, able to instrument real-world scale programs like Chrome or similar).</p>
<p>In this post (it's been a while I know!), I'll introduce the <a href="https://github.com/google/syzygy">syzygy</a> transformation tool chain with a focus on its <a href="https://github.com/google/syzygy/tree/master/syzygy/instrument">instrumenter</a>, and give an overview of the framework, its capabilities, its limitations, and how you can write transformations yourself. As examples, I'll walk through two simple examples: an analysis pass generating a call-graph, and a transformation pass rewriting the function <code>__report_gsfailure</code> in <a href="https://msdn.microsoft.com/en-us/library/8dbf701c.aspx">/GS</a> protected binaries.</p>

                        <a class="btn primary xsmall" href="/blog/2017/08/05/binary-rewriting-with-syzygy/">more ...</a>
                </div>
        </div>
        <hr />
        <div class="article">
                <h1><a href="/blog/2016/12/21/happy-unikernels/">happy unikernels</a></h1>
                <div class="well small"><footer class="post-info">
<span class="label">Date</span>
<abbr class="published" title="2016-12-21T18:59:00-08:00">
        <i class="icon-calendar"></i>Wed 21 December 2016
</abbr>
<span class="label">By</span>
<a href="/author/yrp.html"><i class="icon-user"></i>yrp</a>
<span class="label">Category</span>
<a href="/category/exploitation.html"><i class="icon-folder-open"></i>exploitation</a>


<span class="label">Tags</span>
	<a href="/tag/unikernel.html"><i class="icon-tag"></i>unikernel</a>
	<a href="/tag/rumpkernel.html"><i class="icon-tag"></i>rumpkernel</a>
	<a href="/tag/exploitation.html"><i class="icon-tag"></i>exploitation</a>
</footer><!-- /.post-info --></div>
                <div class="summary"><h1 id="intro">Intro</h1>
<p>Below is a collection of notes regarding unikernels. I had originally prepared this stuff to submit to EkoParty’s CFP, but ended up not wanting to devote time to stabilizing PHP7’s heap structures and I lost interest in the rest of the project before it was complete. However, there are still some cool takeaways I figured I could write down. Maybe they’ll come in handy? If so, please let let me know.</p>
<p>Unikernels are a continuation of turning everything into a container or VM. Basically, as many VMs currently just run one userland application, the idea is that we can simplify our entire software stack by removing the userland/kernelland barrier and essentially compiling our usermode process into the kernel. This is, in the implementation I looked at, done with a NetBSD kernel and a variety of either <a href="https://github.com/rumpkernel/rumprun-packages">native or lightly-patched POSIX applications</a>  (bonus: there is significant lag time between upstream fixes and rump package fixes, just like every other containerized solution).</p>
<p>While I don’t necessarily think that conceptually unikernels are a good idea (attack surface reduction vs mitigation removal), I do think people will start more widely deploying them shortly and I was curious what memory corruption exploitation would look like inside of them, and more generally what your payload options are like.</p>
<p>All of the following is based off of two unikernel programs, nginx and php5 and only makes use of public vulnerabilities. I am happy to provide all referenced code (in varying states of incompleteness), on request.</p>

                        <a class="btn primary xsmall" href="/blog/2016/12/21/happy-unikernels/">more ...</a>
                </div>
        </div>
        <hr />
        <div class="article">
                <h1><a href="/blog/2016/11/27/clang-and-passes/">Token capture via an llvm-based analysis pass</a></h1>
                <div class="well small"><footer class="post-info">
<span class="label">Date</span>
<abbr class="published" title="2016-11-27T20:43:00-08:00">
        <i class="icon-calendar"></i>Sun 27 November 2016
</abbr>
<span class="label">By</span>
<a href="/author/axel-0vercl0k-souchet.html"><i class="icon-user"></i>Axel "0vercl0k" Souchet</a>
<span class="label">Category</span>
<a href="/category/misc.html"><i class="icon-folder-open"></i>misc</a>


<span class="label">Tags</span>
	<a href="/tag/fuzzing.html"><i class="icon-tag"></i>fuzzing</a>
	<a href="/tag/clang.html"><i class="icon-tag"></i>clang</a>
	<a href="/tag/llvm.html"><i class="icon-tag"></i>llvm</a>
	<a href="/tag/analysis-pass.html"><i class="icon-tag"></i>analysis pass</a>
	<a href="/tag/pass.html"><i class="icon-tag"></i>pass</a>
</footer><!-- /.post-info --></div>
                <div class="summary"><h1 id="introduction">Introduction</h1>
<p>About three years ago, the LLVM framework started to pique my interest for a lot of different reasons. This collection of industrial strength compiler technology, as <a href="http://llvm.org/pubs/2008-10-04-ACAT-LLVM-Intro.pdf">Latner</a> said in 2008, was designed in a very modular way. It also looked like it had a lot of interesting features that could be used in a lot of (different) domains: code-optimization (think <a href="https://github.com/JonathanSalwan/Tigress_protection">deobfuscation</a>), (architecture independent) <a href="https://github.com/0vercl0k/articles/blob/master/Obfuscation%20of%20steel%20meet%20Kryptonite.pdf">code obfuscation</a>, static code instrumentation (think <a href="https://github.com/google/sanitizers/wiki">sanitizers</a>), <a href="http://clang-analyzer.llvm.org/index.html">static analysis</a>, for runtime software exploitation mitigations (think <a href="http://clang.llvm.org/docs/ControlFlowIntegrity.html">cfi</a>, <a href="http://clang.llvm.org/docs/SafeStack.html">safestack</a>), power a fuzzing framework (think <a href="http://llvm.org/docs/LibFuzzer.html">libFuzzer</a>), ..you name it.</p>
<p>A lot of the power that came with this giant library was partly because it would operate in mainly three stages, and you were free to hook your code in any of those: front-end, mid-end, back-end. Other strengths included: the high number of back-ends, the documentation, the C/C++ APIs, the community, ease of use compared to gcc (see below from kcc's <a href="https://gcc.gnu.org/wiki/cauldron2012?action=AttachFile&amp;do=get&amp;target=kcc.pdf">presentation</a>), etc.</p>
<p><center><img alt="GCC from a newcomer's perspective" src="/images/token_capture_via_llvm_based_static_analysis_pass/llvmvsgcc.png"></center>
The front-end part takes as input source code and generates LLVM IL code, the middle part operates on LLVM IL and finally the last one receives LLVM IL in order to output assembly code and or an executable file.</p>
<p><center><img alt="Major components in a three phase compiler" src="/images/token_capture_via_llvm_based_static_analysis_pass/llvm_architecture.png"></center>
In this post we will walk through a simple LLVM pass that does neither optimization, nor obfuscation; but acts more as a token finder for fuzzing purposes. </p>

                        <a class="btn primary xsmall" href="/blog/2016/11/27/clang-and-passes/">more ...</a>
                </div>
        </div>
        <hr />
        <div class="article">
                <h1><a href="/blog/2015/08/18/keygenning-with-klee/">Keygenning with KLEE</a></h1>
                <div class="well small"><footer class="post-info">
<span class="label">Date</span>
<abbr class="published" title="2015-08-18T22:12:00-07:00">
        <i class="icon-calendar"></i>Tue 18 August 2015
</abbr>
<span class="label">By</span>
<a href="/author/michele-brt_device-bertasi.html"><i class="icon-user"></i>Michele "brt_device" Bertasi</a>
<span class="label">Category</span>
<a href="/category/reverse-engineering.html"><i class="icon-folder-open"></i>reverse-engineering</a>


<span class="label">Tags</span>
	<a href="/tag/reverse-engineering.html"><i class="icon-tag"></i>reverse-engineering</a>
	<a href="/tag/symbolic-execution.html"><i class="icon-tag"></i>symbolic execution</a>
</footer><!-- /.post-info --></div>
                <div class="summary"><h1 id="introduction">Introduction</h1>
<p>In the past weeks I enjoyed working on reversing a piece of software (don't ask me the name), to study how serial numbers are validated. The story the user has to follow is pretty common: download the trial, pay, get the serial number, use it in the annoying nag screen to get the fully functional version of the software.</p>
<p>Since my purpose is to not damage the company developing the software, I will not mention the name of the software, nor I will publish the final key generator in binary form, nor its source code. My goal is instead to study a real case of serial number validation, and to highlight its weaknesses.</p>
<p>In this post we are going to take a look at the steps I followed to reverse the serial validation process and to make a key generator using <a href="http://klee.github.io/">KLEE</a> symbolic virtual machine. We are not going to follow all the details on the reversing part, since you cannot reproduce them on your own. We will concentrate our thoughts on the key-generator itself: that is the most interesting part.</p>

                        <a class="btn primary xsmall" href="/blog/2015/08/18/keygenning-with-klee/">more ...</a>
                </div>
        </div>
        <hr />
        <div class="article">
                <h1><a href="/blog/2015/02/08/spotlight-on-an-unprotected-aes128-whitebox-implementation/">Spotlight on an unprotected AES128 white-box implementation</a></h1>
                <div class="well small"><footer class="post-info">
<span class="label">Date</span>
<abbr class="published" title="2015-02-08T22:59:00-08:00">
        <i class="icon-calendar"></i>Sun 08 February 2015
</abbr>
<span class="label">By</span>
<a href="/author/axel-0vercl0k-souchet.html"><i class="icon-user"></i>Axel "0vercl0k" Souchet</a>
<span class="label">Category</span>
<a href="/category/obfuscation.html"><i class="icon-folder-open"></i>obfuscation</a>


<span class="label">Tags</span>
	<a href="/tag/obfuscation.html"><i class="icon-tag"></i>obfuscation</a>
	<a href="/tag/white-box.html"><i class="icon-tag"></i>white-box</a>
	<a href="/tag/practical-cryptography.html"><i class="icon-tag"></i>practical cryptography</a>
	<a href="/tag/aes128.html"><i class="icon-tag"></i>aes128</a>
	<a href="/tag/encryption.html"><i class="icon-tag"></i>encryption</a>
</footer><!-- /.post-info --></div>
                <div class="summary"><h1 id="introduction">Introduction</h1>
<p>I think it all began when I've worked on the <a href="https://github.com/0vercl0k/stuffz/tree/master/NoSuchCon2013">NSC2013</a> crackme made by <a href="https://twitter.com/elvanderb">@elvanderb</a>, long story short you had an AES128 heavily obfuscated white-box implementation to break. The thing was you could actually solve the challenge in different ways: </p>
<ol>
<li>the first one was the easiest one: you didn't need to know anything about white-box, crypto or even AES ; you could just see the function as a black-box &amp; try to find "design flaws" in its inner-workings</li>
<li>the elite way: this one involved to understand &amp; recover the entire design of the white-box, then to identify design weaknesses that allows the challenger to directly attack &amp; recover the encryption key. A really nice write-up has been recently written by <a href="https://twitter.com/doegox">@doegox</a>, check it out, really :): <a href="http://wiki.yobi.be/wiki/NSC_Writeups">Oppida/NoSuchCon challenge</a>.</li>
</ol>
<p>The annoying thing is that you don't have a lot of understandable available C code on the web that implement such things, nevertheless you do have quite some nice academic references ; they are a really good resource to build your own.</p>
<p>This post aims to present briefly, in a simple way what an AES white-box looks like, and to show how its design is important if you want to not have your encryption key extracted :). The implementation I'm going to talk about today is not my creation at all, I just followed the first part (might do another post talking about the second part? Who knows) of a really <a href="https://github.com/0vercl0k/stuffz/raw/master/wbaes_attack/docs/a_tutorial_on_whitebox_aes.pdf">nice paper</a> (even for non-mathematical / crypto guys like me!) written by James A. Muir.</p>
<p>The idea is simple: we will start from a clean AES128 encryption function in plain C, we will modify it &amp; transform it into a white-box implementation in several steps.
As usual, all the code are available on my github account; you are encourage to break &amp; hack them!</p>
<p>Of course, we will use this post to briefly present what is the white-box cryptography, what are the goals &amp; why it's kind of cool.</p>
<p>Before diving deep, here is the table of contents:</p>

                        <a class="btn primary xsmall" href="/blog/2015/02/08/spotlight-on-an-unprotected-aes128-whitebox-implementation/">more ...</a>
                </div>
        </div>
        <hr />

        <div class="pagination">
        <ul>
                        <li class="prev disabled"><a href="#">&larr; Previous</a></li>
                        <li class="active"><a href="/index.html">1</a></li>
                        <li class=""><a href="/index2.html">2</a></li>
                        <li class="next"><a href="/index2.html">Next &rarr;</a></li>
        </ul>
        </div>

        </div><!--/span-->
      </div><!--/row-->
      <hr>

      <footer style='background-color:#00000000'>
        <center>
          <address id="about">
                  Proudly powered by <a href="http://pelican.notmyidea.org/">Pelican <i class="icon-external-link"></i></a>,
                                  which takes great advantage of <a href="http://python.org">Python <i class="icon-external-link"></i></a>.
          </address><!-- /#about -->

          <p>The theme is from <a href="http://twitter.github.com/bootstrap/">Bootstrap from Twitter <i class="icon-external-link"></i></a>,
                     and <a href="http://fortawesome.github.com/Font-Awesome/">Font-Awesome <i class="icon-external-link"></i></a>, thanks!</p>
        </center>
      </footer>

    </div><!--/.fluid-container-->


    <script src="/theme/js/jquery-1.7.2.min.js"></script>
    <script src="/theme/js/bootstrap.min.js"></script>
  </body>
</html>